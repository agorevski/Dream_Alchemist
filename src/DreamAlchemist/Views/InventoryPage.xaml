<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:DreamAlchemist.ViewModels"
             x:Class="DreamAlchemist.Views.InventoryPage"
             x:DataType="vm:InventoryViewModel"
             Title="{Binding Title}"
             BackgroundColor="{DynamicResource ThemeBackgroundPrimary}">

    <Grid RowDefinitions="Auto,Auto,*" Padding="10">
        
        <!-- Header -->
        <Frame Grid.Row="0" BackgroundColor="{DynamicResource ThemeBackgroundSecondary}" Padding="15" Margin="0,0,0,10" BorderColor="{DynamicResource ThemeSecondary}">
            <VerticalStackLayout Spacing="10">
                <Label Text="ðŸŽ’ Inventory"
                       FontSize="20"
                       FontAttributes="Bold"
                       TextColor="{DynamicResource ThemeTextPrimary}"/>
                <Label Text="{Binding CapacityText, StringFormat='Weight: {0}'}"
                       FontSize="14"
                       TextColor="{DynamicResource ThemeTextSecondary}"/>
                <ProgressBar Progress="{Binding CapacityPercentage}"
                             ProgressColor="{DynamicResource ThemeSecondary}"
                             HeightRequest="10"/>
            </VerticalStackLayout>
        </Frame>

        <!-- Sort Buttons -->
        <ScrollView Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,10">
            <HorizontalStackLayout Spacing="10">
                <Button Text="Name"
                        Command="{Binding SortByNameCommand}"
                        BackgroundColor="{DynamicResource ThemeBorder}"
                        TextColor="{DynamicResource ThemeTextPrimary}"
                        HeightRequest="35"/>
                <Button Text="Rarity"
                        Command="{Binding SortByRarityCommand}"
                        BackgroundColor="{DynamicResource ThemeBorder}"
                        TextColor="{DynamicResource ThemeTextPrimary}"
                        HeightRequest="35"/>
                <Button Text="Quantity"
                        Command="{Binding SortByQuantityCommand}"
                        BackgroundColor="{DynamicResource ThemeBorder}"
                        TextColor="{DynamicResource ThemeTextPrimary}"
                        HeightRequest="35"/>
                <Button Text="Value"
                        Command="{Binding SortByValueCommand}"
                        BackgroundColor="{DynamicResource ThemeBorder}"
                        TextColor="{DynamicResource ThemeTextPrimary}"
                        HeightRequest="35"/>
            </HorizontalStackLayout>
        </ScrollView>

        <!-- Inventory Items -->
        <CollectionView Grid.Row="2"
                        ItemsSource="{Binding InventoryItems}"
                        SelectedItem="{Binding SelectedItem}"
                        SelectionMode="Single">
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="vm:InventoryItemViewModel">
                    <Frame BackgroundColor="{DynamicResource ThemeBackgroundTertiary}" Padding="15" Margin="0,5">
                        <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="*,Auto">
                            <Label Grid.Row="0" Grid.Column="0"
                                   Text="{Binding Ingredient.Name}"
                                   FontSize="16"
                                   TextColor="{DynamicResource ThemeTextPrimary}"/>
                            <Label Grid.Row="0" Grid.Column="1"
                                   Text="{Binding Quantity, StringFormat='x{0}'}"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   TextColor="{DynamicResource ThemeAccent3}"/>
                            
                            <Label Grid.Row="1" Grid.Column="0"
                                   Text="{Binding Ingredient.Rarity}"
                                   FontSize="12"
                                   TextColor="{DynamicResource ThemePrimary}"/>
                            <Label Grid.Row="1" Grid.Column="1"
                                   Text="{Binding TotalValue, StringFormat='{0:N0} coins'}"
                                   FontSize="12"
                                   TextColor="{DynamicResource ThemeTextSecondary}"/>
                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </Grid>

</ContentPage>
